# Trading Strategy / 거래 전략

## 김치 프리미엄 거래 (Kimchi Premium Arbitrage)

### 기본 개념

**김치 프리미엄**: 국내 거래소(Upbit, Bithumb)와 해외 거래소(Binance, OKX)의 코인 가격 차이

```
김프(%) = (국내가격/환율 - 해외가격) / 해외가격 × 100
```

---

## 거래 시나리오

### 1. 정프 (Positive Premium) - 국내 > 해외

**예시**: BTC 국내 140,000,000원 vs 해외 $96,000 (환율 1450원)
```
국내 USD 가격 = 140,000,000 / 1,450 = $96,552
김프 = (96,552 - 96,000) / 96,000 = 0.57% (정프)
```

**이상적 전략**:
- ✅ 국내에서 BTC **매도** → 원화 140,000,000원 획득
- ✅ 해외에서 BTC **매수** → USDT 96,000 사용
- ✅ 순이익: 약 0.57% (수수료 제외)

**현실적 문제**:
```
❌ 국내에 BTC가 없으면?
   → 국내에서 매도 불가능!

❌ 해외에 USDT가 없으면?
   → 해외에서 매수 불가능!
```

---

### 2. 역프 (Negative Premium) - 국내 < 해외

**예시**: BTC 국내 138,000,000원 vs 해외 $96,000 (환율 1450원)
```
국내 USD 가격 = 138,000,000 / 1,450 = $95,172
역프 = (95,172 - 96,000) / 96,000 = -0.86%
```

**이상적 전략**:
- ✅ 해외에서 BTC **매도** → USDT 96,000 획득
- ✅ 국내에서 BTC **매수** → 원화 138,000,000원 사용
- ✅ 순이익: 약 0.86% (수수료 제외)

**현실적 문제**:
```
❌ 해외에 BTC가 없으면?
   → 해외에서 매도 불가능!

❌ 국내에 원화가 없으면?
   → 국내에서 매수 불가능!
```

---

## 실전 거래 방법

### A. 양방향 자산 보유 (권장)

**초기 자산 배분**:
```
국내: 50% (코인 + 원화)
해외: 50% (코인 + USDT)
```

**거래 흐름**:
1. **정프 발생 시**:
   - 국내 코인 매도 (코인 → 원화)
   - 해외 코인 매수 (USDT → 코인)
   - 결과: 국내 원화↑, 해외 코인↑

2. **역프 발생 시**:
   - 해외 코인 매도 (코인 → USDT)
   - 국내 코인 매수 (원화 → 코인)
   - 결과: 해외 USDT↑, 국내 코인↑

3. **주기적 리밸런싱**:
   - 원화를 USDT로 환전 (또는 반대)
   - 초기 50:50 비율 복원

**장점**:
- ✅ 즉시 거래 가능
- ✅ Margin/대여 불필요
- ✅ 리스크 낮음

**단점**:
- ❌ 큰 자본 필요 (양쪽에 자산)
- ❌ 환전 비용 발생
- ❌ 자산 이동 시간 (국내↔해외)

---

### B. 코인 대여 (Margin/Loan)

#### B-1. 국내 거래소 코인 대여

**Upbit 디지털 자산 대여**:
```
지원 코인: BTC, ETH, XRP, ADA, DOGE 등 (제한적)
대여 이율: 연 5-15% (변동)
최대 대여 기간: 7일
```

**거래 흐름 (정프 시)**:
1. Upbit에서 BTC **대여** (빌림)
2. 대여한 BTC를 Upbit에서 **매도** → 원화 획득
3. Binance에서 BTC **매수** → USDT 사용
4. 김프가 줄어들면:
   - Binance에서 BTC **매도** → USDT 획득
   - Upbit에서 BTC **매수** → 원화 사용
   - 매수한 BTC를 Upbit에 **상환**

**비용**:
```
대여 이자: 연 ~10% (일 0.027%)
매매 수수료: 0.05% × 4회 = 0.2%
총 비용: ~0.23% (1일 기준)
```

**Bithumb**:
- ❌ 2024년 기준 코인 대여 서비스 없음

---

#### B-2. 해외 거래소 Margin Trading

**Binance/OKX Margin**:
```
지원: 거의 모든 메이저 코인
레버리지: 최대 3-10배
이자율: 시간당 ~0.01-0.03%
```

**거래 흐름 (정프 시)**:
1. Binance Margin 계정에서 BTC **대여**
2. 대여한 BTC를 **매도** (Short) → USDT 획득
3. Upbit에서 BTC **매수** → 원화 사용
4. 김프가 줄어들면:
   - Upbit에서 BTC **매도** → 원화 획득
   - Binance에서 BTC **매수** → USDT 사용
   - 매수한 BTC를 Margin에 **상환**

**리스크**:
```
⚠️ 청산 위험: 가격이 반대로 움직이면 강제 청산
⚠️ 높은 이자: 장기 보유 시 수익 감소
⚠️ 복잡성: Margin 계좌 관리 필요
```

---

### C. 실전 권장 전략: **Tether Bot**

**핵심 아이디어**:
```
김프는 항상 3-4% 정도 존재 (노이즈)
→ 유의미한 차이가 있을 때만 거래!
```

**자산 배분 곡선** (현재 시스템 설정):
```python
김프(%)      자산 배분(%)
---------------------
-5.0%   →   100%  (전액 투입, 역프 극대)
-2.0%   →    70%  (대량 투입)
-1.0%   →    50%  (중간 투입)
 0.0%   →    20%  (소량 유지)
+1.0%   →     5%  (최소 투입)
+3.0%   →     0%  (거래 안 함)
```

**거래 조건**:
```
✅ allocation >= 5% 인 경우만 거래
   → 현재 3.6% 김프는 allocation 0% → 필터링됨

✅ 역프 -1%일 때 50% 자산 투입
✅ 역프 -2%일 때 70% 자산 투입

❌ 정프 +3% 이상이면 거래 안 함 (노이즈)
```

**예시**:
```
총 자산: $100,000

김프 -1.5% 발생:
→ allocation ≈ 60% (선형 보간)
→ 권장 투입액: $60,000
→ 실행: 해외에서 $60,000 매도, 국내에서 매수

김프 +3.2% 발생:
→ allocation = 0%
→ 거래 안 함 (노이즈)
```

---

## 정리: "현물 매도"의 의미

### Q: 더따리에서 "현물 매도"는 Margin Short인가요?

**A: 아닙니다!**

1. **이상적으로는**:
   - 국내에 **이미 보유한 코인**을 매도
   - 해외에서 **현물로** 매수
   - → Pure spot arbitrage (Margin 불필요)

2. **자산이 없다면**:
   - **Option A**: 코인 대여 서비스 이용 (Upbit 디지털 자산 대여)
   - **Option B**: Margin Trading (Binance/OKX)
   - **Option C**: 양방향 자산 보유 후 리밸런싱 (권장)

3. **실전에서는**:
   - 대부분 **양방향 자산 보유** 전략 사용
   - 정프/역프 발생 시 양쪽에서 동시 거래
   - 주기적으로 원화↔USDT 환전하여 밸런스 조정

---

## 현재 시스템의 전략

이 시스템은 **Option C (양방향 자산 보유)** 가정:

```python
# 국내 보유: BTC 1개 + 원화 50,000,000원
# 해외 보유: BTC 1개 + USDT 50,000

# 정프 3.6% 발생 (현재)
→ allocation 0% → 거래 안 함 (노이즈)

# 역프 -1.5% 발생 (가정)
→ allocation 60% → $60,000 투입
→ 해외: BTC 0.625개 매도 → USDT 60,000 획득
→ 국내: BTC 0.625개 매수 → 원화 90,000,000 사용
→ 김프가 줄어들면 반대로 거래하여 이익 실현
```

**핵심**:
- ✅ Margin/대여 없이 순수 현물 거래
- ✅ 양쪽에 자산 보유 필요
- ✅ 고빈도 리밸런싱으로 total equity 극대화
- ✅ 유의미한 차이(allocation >= 5%)에만 반응
